<div class="space-y-6">
  <h2 class="text-xl font-semibold text-slate-900 dark:text-white">Blocklists</h2>

  <app-error-alert [message]="store.error()" (dismiss)="store.clearError()" />

  @if (store.loading()) {
    <app-loading-spinner />
  } @else {
    <div
      class="overflow-hidden rounded-lg border border-slate-200 bg-white shadow-sm dark:border-slate-700 dark:bg-slate-800"
    >
      <table class="min-w-full divide-y divide-slate-200 dark:divide-slate-700">
        <thead
          class="bg-slate-50 text-left text-sm font-semibold text-slate-700 dark:bg-slate-900 dark:text-slate-200"
        >
          <tr>
            <th class="px-4 py-3">Name</th>
            <th class="px-4 py-3">URL</th>
            <th class="px-4 py-3">Format</th>
            <th class="px-4 py-3">Enabled</th>
            <th class="px-4 py-3">Last Fetched</th>
            <th class="px-4 py-3">Actions</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-slate-200 text-sm dark:divide-slate-700">
          @for (bl of store.blocklists(); track bl.name) {
            <tr class="hover:bg-slate-50 dark:hover:bg-slate-900">
              <td class="px-4 py-3 font-medium text-slate-900 dark:text-slate-100">
                {{ bl.name }}
              </td>
              <td class="px-4 py-3 text-slate-700 dark:text-slate-200 break-all">{{ bl.url }}</td>
              <td class="px-4 py-3 uppercase text-slate-600 dark:text-slate-300">
                {{ bl.format }}
              </td>
              <td class="px-4 py-3">
                <span
                  class="inline-flex items-center gap-2 rounded-full px-2.5 py-1 text-xs font-semibold"
                  [class.bg-green-100]="bl.enabled"
                  [class.text-green-800]="bl.enabled"
                  [class.bg-slate-200]="!bl.enabled"
                  [class.text-slate-700]="!bl.enabled"
                  [class.dark:bg-green-900]="bl.enabled"
                  [class.dark:text-green-100]="bl.enabled"
                  [class.dark:bg-slate-700]="!bl.enabled"
                  [class.dark:text-slate-200]="!bl.enabled"
                >
                  <span
                    class="h-2 w-2 rounded-full"
                    [class.bg-green-500]="bl.enabled"
                    [class.bg-slate-400]="!bl.enabled"
                  ></span>
                  {{ bl.enabled ? 'Enabled' : 'Disabled' }}
                </span>
              </td>
              <td class="px-4 py-3 text-slate-600 dark:text-slate-300">
                {{ bl.last_fetched || 'â€”' }}
              </td>
              <td class="px-4 py-3">
                <div class="flex items-center gap-2">
                  <button
                    class="rounded bg-slate-200 px-2.5 py-1 text-xs font-semibold text-slate-800 hover:bg-slate-300 dark:bg-slate-700 dark:text-slate-100 dark:hover:bg-slate-600"
                    (click)="store.refreshBlocklist(bl.name)"
                  >Refresh</button>
                  <button
                    class="rounded px-2.5 py-1 text-xs font-semibold"
                    [class.bg-green-100]="!bl.enabled"
                    [class.text-green-800]="!bl.enabled"
                    [class.bg-red-100]="bl.enabled"
                    [class.text-red-800]="bl.enabled"
                    [class.dark:bg-green-900]="!bl.enabled"
                    [class.dark:text-green-100]="!bl.enabled"
                    [class.dark:bg-red-900]="bl.enabled"
                    [class.dark:text-red-100]="bl.enabled"
                    (click)="store.setBlocklistEnabled({ name: bl.name, enabled: !bl.enabled })"
                  >{{ bl.enabled ? 'Disable' : 'Enable' }}</button>
                </div>
                <div class="mt-1 text-xs text-slate-500 dark:text-slate-400">
                  Changes take effect after restart.
                </div>
              </td>
            </tr>
          } @empty {
            <tr>
              <td class="px-4 py-6 text-center text-slate-600 dark:text-slate-300" colspan="5">
                No blocklists configured.
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  }
</div>
