<div class="space-y-6">
  <div class="flex flex-wrap items-center justify-between gap-4">
    <h1 class="text-2xl font-bold text-slate-900 dark:text-white">Configuration</h1>
    <button
      type="button"
      class="rounded-md bg-blue-600 px-4 py-2 text-sm font-medium text-white transition-colors hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50"
      (click)="saveChanges()"
      [disabled]="store.saving()"
    >
      {{ store.saving() ? 'Saving...' : 'Save Changes' }}
    </button>
  </div>

  <app-error-alert [message]="store.error()" (dismiss)="store.clearError()" />

  @if (store.loading()) {
    <app-loading-spinner />
  }

  @if (store.config(); as config) {
    <div class="grid gap-6 lg:grid-cols-4">
      <!-- Navigation Sidebar -->
      <nav class="lg:col-span-1">
        <div
          class="rounded-lg border border-slate-200 bg-white p-4 dark:border-slate-700 dark:bg-slate-800"
        >
          <h2
            class="mb-3 text-sm font-semibold uppercase tracking-wider text-slate-500 dark:text-slate-400"
          >
            Sections
          </h2>
          <ul class="space-y-1">
            <li>
              <button
                type="button"
                (click)="setActiveSection('server')"
                [class]="
                  activeSection() === 'server'
                    ? 'bg-blue-50 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400'
                    : 'text-slate-700 hover:bg-slate-100 dark:text-slate-300 dark:hover:bg-slate-700'
                "
                class="w-full rounded-lg px-3 py-2 text-left text-sm font-medium transition-colors"
              >
                üñ•Ô∏è Server
              </button>
            </li>
            <li>
              <button
                type="button"
                (click)="setActiveSection('upstream')"
                [class]="
                  activeSection() === 'upstream'
                    ? 'bg-blue-50 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400'
                    : 'text-slate-700 hover:bg-slate-100 dark:text-slate-300 dark:hover:bg-slate-700'
                "
                class="w-full rounded-lg px-3 py-2 text-left text-sm font-medium transition-colors"
              >
                ‚¨ÜÔ∏è Upstream
              </button>
            </li>
            <li>
              <button
                type="button"
                (click)="setActiveSection('logging')"
                [class]="
                  activeSection() === 'logging'
                    ? 'bg-blue-50 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400'
                    : 'text-slate-700 hover:bg-slate-100 dark:text-slate-300 dark:hover:bg-slate-700'
                "
                class="w-full rounded-lg px-3 py-2 text-left text-sm font-medium transition-colors"
              >
                üìã Logging
              </button>
            </li>
            <li>
              <button
                type="button"
                (click)="setActiveSection('rateLimit')"
                [class]="
                  activeSection() === 'rateLimit'
                    ? 'bg-blue-50 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400'
                    : 'text-slate-700 hover:bg-slate-100 dark:text-slate-300 dark:hover:bg-slate-700'
                "
                class="w-full rounded-lg px-3 py-2 text-left text-sm font-medium transition-colors"
              >
                üö¶ Rate Limiting
              </button>
            </li>
          </ul>
        </div>
      </nav>

      <!-- Content Area -->
      <div class="lg:col-span-3">
        <div
          class="rounded-lg border border-slate-200 bg-white p-6 dark:border-slate-700 dark:bg-slate-800"
        >
          <!-- Server Configuration -->
          @if (activeSection() === 'server') {
            <div class="space-y-6">
              <h2 class="text-xl font-semibold text-slate-900 dark:text-white">
                Server Configuration
              </h2>

              <div class="grid gap-4 sm:grid-cols-2">
                <div>
                  <label
                    for="server-host"
                    class="mb-1 block text-sm font-medium text-slate-700 dark:text-slate-300"
                    >Host</label
                  >
                  <input
                    id="server-host"
                    type="text"
                    [(ngModel)]="config.server.host"
                    class="w-full rounded-md border border-slate-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:border-slate-600 dark:bg-slate-700 dark:text-white"
                    placeholder="0.0.0.0"
                  />
                </div>

                <div>
                  <label
                    for="server-port"
                    class="mb-1 block text-sm font-medium text-slate-700 dark:text-slate-300"
                    >Port</label
                  >
                  <input
                    id="server-port"
                    type="number"
                    [(ngModel)]="config.server.port"
                    class="w-full rounded-md border border-slate-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:border-slate-600 dark:bg-slate-700 dark:text-white"
                    placeholder="53"
                  />
                </div>

                <div>
                  <label
                    for="server-workers"
                    class="mb-1 block text-sm font-medium text-slate-700 dark:text-slate-300"
                    >Workers</label
                  >
                  <input
                    id="server-workers"
                    type="text"
                    [(ngModel)]="config.server.workers"
                    class="w-full rounded-md border border-slate-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:border-slate-600 dark:bg-slate-700 dark:text-white"
                    placeholder="auto"
                  />
                  <p class="mt-1 text-xs text-slate-500 dark:text-slate-400">
                    Use "auto" or a number
                  </p>
                </div>

                <div>
                  <label
                    for="server-concurrency"
                    class="mb-1 block text-sm font-medium text-slate-700 dark:text-slate-300"
                    >Max Concurrency</label
                  >
                  <input
                    id="server-concurrency"
                    type="number"
                    [(ngModel)]="config.server.max_concurrency"
                    class="w-full rounded-md border border-slate-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:border-slate-600 dark:bg-slate-700 dark:text-white"
                    placeholder="10000"
                  />
                </div>

                <div>
                  <label
                    for="server-pool-size"
                    class="mb-1 block text-sm font-medium text-slate-700 dark:text-slate-300"
                    >Upstream Socket Pool Size</label
                  >
                  <input
                    id="server-pool-size"
                    type="number"
                    [(ngModel)]="config.server.upstream_socket_pool_size"
                    class="w-full rounded-md border border-slate-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:border-slate-600 dark:bg-slate-700 dark:text-white"
                    placeholder="100"
                  />
                </div>
              </div>

              <div class="space-y-3">
                <label class="flex items-center gap-2">
                  <input
                    type="checkbox"
                    [(ngModel)]="config.server.enable_tcp"
                    class="h-4 w-4 rounded border-slate-300 text-blue-600 focus:ring-2 focus:ring-blue-500 dark:border-slate-600 dark:bg-slate-700"
                  />
                  <span class="text-sm font-medium text-slate-700 dark:text-slate-300"
                    >Enable TCP</span
                  >
                </label>

                <label class="flex items-center gap-2">
                  <input
                    type="checkbox"
                    [(ngModel)]="config.server.tcp_fallback"
                    class="h-4 w-4 rounded border-slate-300 text-blue-600 focus:ring-2 focus:ring-blue-500 dark:border-slate-600 dark:bg-slate-700"
                  />
                  <span class="text-sm font-medium text-slate-700 dark:text-slate-300"
                    >TCP Fallback</span
                  >
                </label>
              </div>
            </div>
          }

          <!-- Upstream Configuration -->
          @if (activeSection() === 'upstream') {
            <div class="space-y-6">
              <h2 class="text-xl font-semibold text-slate-900 dark:text-white">
                Upstream Configuration
              </h2>

              <div>
                <label
                  for="upstream-servers"
                  class="mb-1 block text-sm font-medium text-slate-700 dark:text-slate-300"
                >
                  Upstream DNS Servers
                </label>
                <textarea
                  id="upstream-servers"
                  [ngModel]="upstreamServersText()"
                  (ngModelChange)="onUpstreamServersChange($event)"
                  rows="6"
                  class="w-full rounded-md border border-slate-300 px-3 py-2 text-sm font-mono focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:border-slate-600 dark:bg-slate-700 dark:text-white"
                  placeholder="8.8.8.8:53&#10;8.8.4.4:53&#10;1.1.1.1:53"
                ></textarea>
                <p class="mt-1 text-xs text-slate-500 dark:text-slate-400">
                  One server per line (host:port)
                </p>
              </div>

              <div class="grid gap-4 sm:grid-cols-2">
                <div>
                  <label
                    for="upstream-timeout"
                    class="mb-1 block text-sm font-medium text-slate-700 dark:text-slate-300"
                    >Timeout</label
                  >
                  <input
                    id="upstream-timeout"
                    type="text"
                    [(ngModel)]="config.upstream.timeout"
                    class="w-full rounded-md border border-slate-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:border-slate-600 dark:bg-slate-700 dark:text-white"
                    placeholder="2s"
                  />
                  <p class="mt-1 text-xs text-slate-500 dark:text-slate-400">
                    Duration (e.g., 2s, 500ms)
                  </p>
                </div>

                <div>
                  <label
                    for="upstream-retries"
                    class="mb-1 block text-sm font-medium text-slate-700 dark:text-slate-300"
                    >Retries</label
                  >
                  <input
                    id="upstream-retries"
                    type="number"
                    [(ngModel)]="config.upstream.retries"
                    class="w-full rounded-md border border-slate-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:border-slate-600 dark:bg-slate-700 dark:text-white"
                    placeholder="3"
                  />
                </div>
              </div>
            </div>
          }

          <!-- Logging Configuration -->
          @if (activeSection() === 'logging') {
            <div class="space-y-6">
              <h2 class="text-xl font-semibold text-slate-900 dark:text-white">
                Logging Configuration
              </h2>

              <div class="grid gap-4 sm:grid-cols-2">
                <div>
                  <label
                    for="log-level"
                    class="mb-1 block text-sm font-medium text-slate-700 dark:text-slate-300"
                    >Log Level</label
                  >
                  <select
                    id="log-level"
                    [(ngModel)]="config.logging.level"
                    class="w-full rounded-md border border-slate-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:border-slate-600 dark:bg-slate-700 dark:text-white"
                  >
                    <option value="debug">Debug</option>
                    <option value="info">Info</option>
                    <option value="warn">Warn</option>
                    <option value="error">Error</option>
                  </select>
                </div>

                <div>
                  <label
                    for="log-format"
                    class="mb-1 block text-sm font-medium text-slate-700 dark:text-slate-300"
                    >Log Format</label
                  >
                  <select
                    id="log-format"
                    [(ngModel)]="config.logging.format"
                    class="w-full rounded-md border border-slate-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:border-slate-600 dark:bg-slate-700 dark:text-white"
                  >
                    <option value="json">JSON</option>
                    <option value="text">Text</option>
                  </select>
                </div>
              </div>
            </div>
          }

          <!-- Rate Limiting Configuration -->
          @if (activeSection() === 'rateLimit') {
            <div class="space-y-6">
              <h2 class="text-xl font-semibold text-slate-900 dark:text-white">
                Rate Limiting Configuration
              </h2>

              <label class="flex items-center gap-2">
                <input
                  type="checkbox"
                  [(ngModel)]="config.rate_limit.enabled"
                  class="h-4 w-4 rounded border-slate-300 text-blue-600 focus:ring-2 focus:ring-blue-500 dark:border-slate-600 dark:bg-slate-700"
                />
                <span class="text-sm font-medium text-slate-700 dark:text-slate-300"
                  >Enable Rate Limiting</span
                >
              </label>

              @if (config.rate_limit.enabled) {
                <div class="grid gap-4 sm:grid-cols-2">
                  <div>
                    <label
                      for="rate-limit-rps"
                      class="mb-1 block text-sm font-medium text-slate-700 dark:text-slate-300"
                      >Requests Per Second</label
                    >
                    <input
                      id="rate-limit-rps"
                      type="number"
                      [(ngModel)]="config.rate_limit.requests_per_second"
                      class="w-full rounded-md border border-slate-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:border-slate-600 dark:bg-slate-700 dark:text-white"
                      placeholder="100"
                    />
                  </div>

                  <div>
                    <label
                      for="rate-limit-burst"
                      class="mb-1 block text-sm font-medium text-slate-700 dark:text-slate-300"
                      >Burst Size</label
                    >
                    <input
                      id="rate-limit-burst"
                      type="number"
                      [(ngModel)]="config.rate_limit.burst"
                      class="w-full rounded-md border border-slate-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:border-slate-600 dark:bg-slate-700 dark:text-white"
                      placeholder="200"
                    />
                  </div>
                </div>
              }
            </div>
          }
        </div>
      </div>
    </div>
  }
</div>
